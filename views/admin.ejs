<!DOCTYPE html>
<html>
<head><title>Admin Panel</title><link rel="stylesheet" href="/styles.css"></head>
<body>
<%- include('partials/_header') %>
<main class="main-content">
    <h2>Admin Panel</h2>
    <h3>All Users</h3>
    <ul>
        <% users.forEach(u => { %>
            <li><%= u.username %> — <%= u.role %> — 
                <% if (u.isOnline) { %><span class="status-online">Online</span><% } else { %>
                    <span class="status-offline">Last active: <%= u.lastActive.toLocaleString() %></span><% } %>
            </li>
        <% }) %>
    </ul>

    <h3>Global Announcement</h3>
    <form id="admin-message-form">
        <textarea id="admin-announcement" required></textarea>
        <button type="submit">Send Announcement</button>
    </form>
</main>
<script>
document.getElementById("admin-message-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const message = document.getElementById("admin-announcement").value;
    await fetch("/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message, fromAdmin: true })
    });
    e.target.reset();
});
</script>
</body>
</html>