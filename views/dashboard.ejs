<!DOCTYPE html>
<html>
<head>
    <title>Neo IRC Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<header class="main-header">
    <nav class="toolbar dashboard-toolbar">
        <div class="toolbar-left">
            <a href="/dashboard">🏠 Home</a>
            <a href="/channels">📡 Channels</a>
            <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                <a href="/admin">🛠️ Admin</a>
            <% } %>
        </div>
        <div class="toolbar-right">
            <span class="user-badge">Logged in as: <%= username %></span>
            <button onclick="toggleZoom()">🔍 Zoom</button>
            <form action="/logout" method="POST">
                <button type="submit">⏏️ Logout</button>
            </form>
        </div>
    </nav>
</header>

<main class="main-content">
    <h2>👤 Welcome, <%= username %> — Channel: #<%= currentChannel %></h2>

    <div class="chat-layout">
        <aside class="user-list">
            <h4>🧬 Connected Users</h4>
            <ul id="user-list">
                <% users.forEach(user => { %>
                    <li class="user-entry" data-username="<%= user.username %>">
                        <%= user.username %>
                        <% if (user.isOnline) { %>
                            <span class="online">●</span>
                        <% } else { %>
                            <span class="offline">○</span>
                        <% } %>
                    </li>
                <% }) %>
            </ul>
        </aside>

        <section class="chat-box">
            <div class="chat-tabs">
                <button class="tab-btn" data-target="chat-stream">💬 Chat</button>
                <button class="tab-btn" data-target="notifications-stream">📢 Announcements</button>
                <button class="tab-btn" data-target="private-stream">🕵️ Private</button>
            </div>

            <div id="chat-stream" class="chat-stream active">
                <% messages.filter(msg => !msg.isPrivate && !msg.isAnnouncement).forEach(msg => { %>
                    <div>
                        <strong><%= msg.sender %></strong>
                        <span class="timestamp">[<%= new Date(msg.timestamp).toLocaleString() %>]</span><br>
                        <span><%= msg.content %></span>
                    </div>
                <% }) %>
            </div>

            <div id="notifications-stream" class="chat-stream">
                <% messages.filter(msg => msg.isAnnouncement).forEach(msg => { %>
                    <div class="announcement">
                        <strong>📢 <%= msg.sender %></strong>
                        <span class="timestamp"><%= new Date(msg.timestamp).toLocaleString() %></span><br>
                        <span><%= msg.content %></span>
                    </div>
                <% }) %>
            </div>

            <div id="private-stream" class="chat-stream">
                <% messages.filter(msg => msg.isPrivate).forEach(msg => { %>
                    <div>
                        <em>[Private to <%= msg.to %>]</em><br>
                        <strong><%= msg.sender %></strong>
                        <span class="timestamp">[<%= new Date(msg.timestamp).toLocaleString() %>]</span><br>
                        <span><%= msg.content %></span>
                    </div>
                <% }) %>
            </div>
        </section>
    </div>

    <form id="chat-form">
        <input type="text" id="message-input" name="message" placeholder="✍️ Type message..." required>
        <input type="text" id="to-user" name="to" placeholder="👤 Private to... (optional)">
        <input type="hidden" id="channel-name" name="channel" value="<%= currentChannel %>">
        <button type="submit">🚀 Send</button>
    </form>
</main>

<script src="/frontend.js"></script>
<script>
    function toggleZoom() {
        document.body.classList.toggle('zoomed');
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.chat-stream').forEach(s => s.classList.remove('active'));
            const id = btn.dataset.target;
            document.getElementById(id)?.classList.add('active');
        });
    });
</script>
</body>
</html>
