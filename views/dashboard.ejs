<!DOCTYPE html>
<html>
<head>
    <title>Chat Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<%- include('partials/_header') %>
<main class="main-content">
    <h2>Welcome, <%= username %> — Channel: <%= currentChannel %></h2>

    <div class="chat-layout">
        <div class="user-list">
            <h4>Users</h4>
            <ul id="user-list">
                <% users.forEach(user => { %>
                    <li class="user-entry" data-username="<%= user.username %>">
                        <%= user.username %>
                        <% if (user.isOnline) { %><span class="online">●</span><% } else { %><span class="offline">○</span><% } %>
                    </li>
                <% }) %>
            </ul>
        </div>

        <div class="chat-box" id="chat-box">
            <% messages.forEach(msg => { %>
                <div class="<%= msg.isAnnouncement ? 'announcement' : '' %>">
                    <% if (msg.isPrivate) { %>
                        <em>[Private to <%= msg.to %>]</em>
                    <% } %>
                    <strong><%= msg.sender %></strong> [<%= msg.timestamp.toLocaleString() %>]: <%= msg.content %>
                </div>
            <% }) %>
        </div>
    </div>

    <form id="chat-form">
        <input type="text" id="message-input" name="message" placeholder="Type message..." required>
        <input type="text" id="to-user" name="to" placeholder="Optional: user to message privately">
        <input type="hidden" id="channel-name" name="channel" value="<%= currentChannel %>">
        <button type="submit">Send</button>
    </form>
</main>
<script src="/frontend.js"></script>
</body>
</html>